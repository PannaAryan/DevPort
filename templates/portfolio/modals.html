<!-- Experience Modal -->
<div id="experienceModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-gray-900">Add Work Experience</h3>
            <button onclick="closeModal('experienceModal')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form id="experienceForm" class="space-y-4">
            {% csrf_token %}
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Company *</label>
                    <input type="text" name="company" class="form-input" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Position *</label>
                    <input type="text" name="position" class="form-input" required>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                <input type="text" name="location" class="form-input">
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Start Date *</label>
                    <input type="date" name="start_date" class="form-input" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                    <input type="date" name="end_date" class="form-input" id="exp_end_date">
                </div>
            </div>
            
            <div class="flex items-center">
                <input type="checkbox" name="is_current" class="form-checkbox" id="exp_is_current">
                <label for="exp_is_current" class="ml-2 block text-sm text-gray-700">
                    I currently work here
                </label>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
                <textarea name="description" rows="4" class="form-textarea" required 
                          placeholder="Describe your role, responsibilities, and achievements..."></textarea>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="closeModal('experienceModal')" class="btn-secondary">Cancel</button>
                <button type="submit" class="btn-primary">Add Experience</button>
            </div>
        </form>
    </div>
</div>

<!-- Education Modal -->
<div id="educationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-gray-900">Add Education</h3>
            <button onclick="closeModal('educationModal')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form id="educationForm" class="space-y-4">
            {% csrf_token %}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Institution *</label>
                <input type="text" name="institution" class="form-input" required>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Degree *</label>
                    <input type="text" name="degree" class="form-input" required 
                           placeholder="e.g., Bachelor of Science">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Field of Study</label>
                    <input type="text" name="field_of_study" class="form-input" 
                           placeholder="e.g., Computer Science">
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Start Date *</label>
                    <input type="date" name="start_date" class="form-input" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                    <input type="date" name="end_date" class="form-input">
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea name="description" rows="3" class="form-textarea" 
                          placeholder="Additional details, achievements, or relevant coursework..."></textarea>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="closeModal('educationModal')" class="btn-secondary">Cancel</button>
                <button type="submit" class="btn-primary">Add Education</button>
            </div>
        </form>
    </div>
</div>

<!-- Skill Modal -->
<div id="skillModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-gray-900">Add Skill</h3>
            <button onclick="closeModal('skillModal')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form id="skillForm" class="space-y-4">
            {% csrf_token %}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Skill Name *</label>
                <input type="text" name="name" class="form-input" required 
                       placeholder="e.g., Python, React, Docker">
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select name="category" class="form-select">
                        <option value="programming">Programming Languages</option>
                        <option value="frameworks">Frameworks & Libraries</option>
                        <option value="tools">Tools & Technologies</option>
                        <option value="databases">Databases</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Proficiency (1-5)</label>
                    <input type="number" name="proficiency" class="form-input" min="1" max="5" value="3">
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="closeModal('skillModal')" class="btn-secondary">Cancel</button>
                <button type="submit" class="btn-primary">Add Skill</button>
            </div>
        </form>
    </div>
</div>

<!-- Project Modal -->
<div id="projectModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-gray-900">Add Project</h3>
            <button onclick="closeModal('projectModal')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form id="projectForm" class="space-y-4">
            {% csrf_token %}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Project Name *</label>
                <input type="text" name="name" class="form-input" required>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
                <textarea name="description" rows="4" class="form-textarea" required 
                          placeholder="Describe what the project does, your role, and key features..."></textarea>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Tech Stack *</label>
                <input type="text" name="tech_stack" class="form-input" required 
                       placeholder="e.g., Python, Django, JavaScript, React, PostgreSQL">
                <p class="text-sm text-gray-500 mt-1">Separate technologies with commas</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">GitHub URL</label>
                    <input type="url" name="github_url" class="form-input" 
                           placeholder="https://github.com/username/project">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Live Demo URL</label>
                    <input type="url" name="live_url" class="form-input" 
                           placeholder="https://project-demo.com">
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Project Image</label>
                <input type="file" name="image" class="form-file" accept="image/*">
            </div>
            
            <div class="flex items-center">
                <input type="checkbox" name="featured" class="form-checkbox">
                <label class="ml-2 block text-sm text-gray-700">
                    Featured project (highlight this project)
                </label>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="closeModal('projectModal')" class="btn-secondary">Cancel</button>
                <button type="submit" class="btn-primary">Add Project</button>
            </div>
        </form>
    </div>
</div>

<!-- Certification Modal -->
<div id="certificationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-gray-900">Add Certification</h3>
            <button onclick="closeModal('certificationModal')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form id="certificationForm" class="space-y-4">
            {% csrf_token %}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Certification Name *</label>
                <input type="text" name="name" class="form-input" required 
                       placeholder="e.g., AWS Certified Solutions Architect">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Issuing Organization *</label>
                <input type="text" name="issuing_organization" class="form-input" required 
                       placeholder="e.g., Amazon Web Services">
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Issue Date *</label>
                    <input type="date" name="issue_date" class="form-input" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Expiry Date</label>
                    <input type="date" name="expiry_date" class="form-input">
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Credential ID</label>
                    <input type="text" name="credential_id" class="form-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Credential URL</label>
                    <input type="url" name="credential_url" class="form-input" 
                           placeholder="https://verify.certification.com">
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" onclick="closeModal('certificationModal')" class="btn-secondary">Cancel</button>
                <button type="submit" class="btn-primary">Add Certification</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Handle current job checkbox
    document.getElementById('exp_is_current').addEventListener('change', function() {
        const endDateInput = document.getElementById('exp_end_date');
        if (this.checked) {
            endDateInput.disabled = true;
            endDateInput.value = '';
        } else {
            endDateInput.disabled = false;
        }
    });

    // Form submission handlers
    document.getElementById('experienceForm').addEventListener('submit', function(e) {
        e.preventDefault();
        submitForm(this, '{% url "portfolio:add_experience" portfolio.slug %}', 'experienceModal');
    });

    document.getElementById('educationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        submitForm(this, '{% url "portfolio:add_education" portfolio.slug %}', 'educationModal');
    });

    document.getElementById('skillForm').addEventListener('submit', function(e) {
        e.preventDefault();
        submitForm(this, '{% url "portfolio:add_skill" portfolio.slug %}', 'skillModal');
    });

    document.getElementById('projectForm').addEventListener('submit', function(e) {
        e.preventDefault();
        submitForm(this, '{% url "portfolio:add_project" portfolio.slug %}', 'projectModal');
    });

    document.getElementById('certificationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        submitForm(this, '{% url "portfolio:add_certification" portfolio.slug %}', 'certificationModal');
    });

    function submitForm(form, url, modalId) {
        const formData = new FormData(form);
        
        fetch(url, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                closeModal(modalId);
                form.reset();
                location.reload(); // Refresh to show new item
            } else {
                alert('Error: ' + (data.message || 'Something went wrong'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while saving');
        });
    }
</script>

